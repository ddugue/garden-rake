$:.unshift File.expand_path("../../lib", __FILE__)
require 'rake/garden'
include Garden

s = StraceParser.new [
"++++",
'open(david, "AOE(aeo,daw)", fam, [family, honor, courage], {dav: boom}) = 0',
'close(david, "AOE(aeo,daw)", fam, [family, honor, courage], {dav: boom}) = 0',
'open(anto, "AOE(aeo,daw)", fam, [family, honor, courage], {dav: boom}) = 0',
"---"
]
s.each do |fn, args, rest|
  puts "FN #{fn}"
  puts "ARGS #{args.to_s}"
  puts "FIRST ARG #{args.array[0].to_s}"
  puts "REST #{rest}"
end

exit

# options.config = parse "--config", :default => ''
options.debug = "BOD"
options.on "--custom-debug" do |v|
  options.verbose = true
end

options.test_env = env "boo", default: 24

# options.from options.config

a = chore :booty do
  echo options.debug
  echo options.verbose.to_s
  echo options.test_env
end

chore :bam => ["copy/*.txt"] do |t|
  echo "Testing chore"
  t.files.each do |f|
    cp f, "sub/%f.2.txt"
    sh "sleep 5 && echo 'DAN'"
    # sh "echo 'Oops' && exit 1"
    cd "sub"
    cd ".."
    set :PROBLEM, 'no'
    sh f >> "echo $PROBLEM > sub/%b.dat" >> "sub/%b.dat"
    unset :PROBLEM
    sync do
      cp f, "new/%b.boo"
      sh "new/%b.boo" >> "rm new/%b.boo"
    end
  end
end

chore :test => [:bam, :booty] do |t|
  t.files.each do |f|
    puts "File changed #{f}"
  end
end
